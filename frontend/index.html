<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Nutanix PSO â€” Proposal Builder</title>
  <meta name="color-scheme" content="light">
  <meta name="theme-color" content="#f3f4f6">

  <!-- IBM Plex Sans -->
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
  /* =========================
     THEME + TOKENS (LIGHT GREY)
  ========================= */
  :root{
    --bg: #e5e7eb;            /* page background: soft grey */
    --surface: #f3f4f6;       /* header/toolbar surface */
    --card: #f9fafb;          /* cards slightly off-white */
    --muted: #6b7280;
    --muted-2:#4b5563;
    --accent: #0ea5e9;
    --accent-2: #06b6d4;
    --accent-3: #0369a1;
    --glass: rgba(15,23,42,0.05);
    --border: rgba(15,23,42,0.14);
    --text: #111827;
    --text-soft: #374151;
    --shadow-md: 0 10px 26px rgba(15,23,42,.10);
    --shadow-lg: 0 24px 60px rgba(15,23,42,.14);
    --focus: 0 0 0 3px rgba(14,165,233,.32);
    --ring: 0 0 0 2px rgba(14,165,233,.6);
    --radius: 14px;
    --radius-sm: 10px;
    --radius-xs: 8px;
    --grid-gap: 20px;
    --pad: 20px;
    --pad-lg: 24px;
  }

  @media (prefers-reduced-motion:no-preference){
    :root{ --transition: 180ms cubic-bezier(.2,.7,.2,1); }
  }

  /* =========================
     BASE
  ========================= */
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    background:
      radial-gradient(1100px 580px at 80% -80px, rgba(148,163,184,.35), transparent 55%),
      radial-gradient(1000px 600px at 0% 120%, rgba(148,163,184,.18), transparent 55%),
      var(--bg);
    color:var(--text);
    font-family: "IBM Plex Sans", Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    padding:24px;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    font-size:15px;
    line-height:1.45;
  }
  .wrap{max-width:1320px;margin:0 auto}
  noscript{
    display:block;
    color:#b91c1c;
    background:rgba(248,113,113,.06);
    padding:12px;
    border:1px solid rgba(248,113,113,.35);
    border-radius:10px;
    margin-bottom:12px;
  }

  a{color:var(--accent-3);text-decoration:none}
  a:hover{text-decoration:underline}
  :focus-visible{outline:none; box-shadow: var(--focus); border-radius:10px}

  /* Progress bar */
  .progress-wrap{
    display:none; align-items:center; gap:10px;
    margin-top:12px; padding:10px;
    border:1px solid rgba(15,23,42,.12);
    border-radius:10px; background:rgba(243,244,246,.96);
  }
  .progress-label{ font-size:12.5px; color:var(--muted) }
  .progress{
    position:relative; flex:1; height:10px; border-radius:999px;
    overflow:hidden; background:rgba(148,163,184,.35);
  }
  .progress .bar{
    position:absolute; inset:0; width:40%;
    background:linear-gradient(90deg, var(--accent), var(--accent-2));
    animation: pso-indeterminate 1.1s infinite ease-in-out;
    border-radius:999px;
  }
  @keyframes pso-indeterminate{
    0%{ left:-40% } 50%{ left:60% } 100%{ left:100% }
  }
  .progress.ok .bar{
    animation:none; left:0; width:100%;
    background:linear-gradient(90deg,#16a34a,#22c55e);
  }
  .progress.err .bar{
    animation:none; left:0; width:100%;
    background:linear-gradient(90deg,#ef4444,#f97373);
  }

  /* =========================
     HEADER + PROFILE
  ========================= */
  header{
    position: sticky; top: 12px; z-index: 10;
    display:flex;align-items:center;justify-content:space-between;gap:18px;
    margin-bottom:22px;padding:14px var(--pad);
    background: linear-gradient(180deg, rgba(243,244,246,.98), rgba(249,250,251,.98));
    border:1px solid rgba(15,23,42,.12);
    border-radius: var(--radius);
    box-shadow: var(--shadow-md);
    backdrop-filter: blur(4px);
  }
  .brand{display:flex;gap:14px;align-items:center}
  .logo {
    width: 120px;                 /* increase width */
    height: auto;                 /* auto height */
    border-radius: 8px;           /* optional */
    display: flex;
    align-items: center;
    justify-content: center;
    background: none !important;  /* remove gradient background */
    box-shadow: none !important;  /* remove shadow */
  }

  .logo img {
    width: 100%;
    height: auto;
    object-fit: contain;          /* prevents distortion */
    display: block;
  }
  h1{font-size:19px;font-weight:800;margin-bottom:2px;letter-spacing:.2px;color:#0f172a}
  .subtitle{color:var(--muted);font-size:13px}

  /* =========================
     LAYOUT
  ========================= */
  .grid{display:grid;grid-template-columns:1fr;gap:var(--grid-gap)}
  @media (min-width:1100px){
    .grid2{display:grid;grid-template-columns: minmax(0,1fr) 420px;gap: var(--grid-gap)}
  }

  /* =========================
     CARDS
  ========================= */
  .card{
    background:linear-gradient(180deg, rgba(249,250,251,.96), rgba(249,250,251,1)), var(--card);
    border-radius:var(--radius);
    padding:var(--pad-lg);
    border:1px solid rgba(15,23,42,0.12);
    box-shadow:var(--shadow-md);
  }
  .card + .card{margin-top: 10px}
  .card-header{
    display:flex;align-items:center;justify-content:space-between;
    margin-bottom:14px;padding-bottom:10px;
    border-bottom:1px solid rgba(148,163,184,0.55)
  }
  .card-title{font-size:16px;font-weight:800;color:#111827}

  /* =========================
     FORMS
  ========================= */
  .form-grid{display:grid;grid-template-columns:1fr;gap:14px}
  @media (min-width:980px){ .form-grid{grid-template-columns:repeat(4, 1fr)} }
  label{
    display:block;font-size:11px;font-weight:800;
    color:var(--muted);margin-bottom:8px;letter-spacing:.4px;
    text-transform:uppercase;
  }
  input[type=text],input[type=number],textarea,select{
    width:100%; padding:11px 12px; border-radius:var(--radius-xs);
    border:1px solid var(--border);
    background:#f3f4f6; color:var(--text); font-size:14px;
    transition: border-color var(--transition), box-shadow var(--transition), background var(--transition);
  }
  input::placeholder, textarea::placeholder{color:#9ca3af}
  input:focus, select:focus, textarea:focus{
    border-color:rgba(14,165,233,.75);
    box-shadow: var(--ring);
    outline:none;
    background:#ffffff;
  }
  textarea{min-height:120px;resize:vertical}
  .row{display:flex;gap:10px;align-items:center;justify-content:space-between}
  .help-text{font-size:12px;color:var(--muted);margin-top:8px}

  /* =========================
     BUTTONS
  ========================= */
  .btn{
    background:var(--accent); color:#ffffff; padding:10px 14px;
    border-radius:10px;border:none;font-weight:800;cursor:pointer;
    display:inline-flex;align-items:center;gap:8px;
    transition: transform var(--transition), opacity var(--transition), background var(--transition), box-shadow var(--transition);
    box-shadow: 0 6px 18px rgba(15,23,42,.18);
  }
  .btn:hover{ transform: translateY(-1px); background:var(--accent-2); }
  .btn:active{ transform: translateY(0) scale(.99) }
  .btn[disabled]{ opacity:.65; cursor:not-allowed; transform:none; box-shadow:none }
  .btn.ghost{
    background:#f9fafb;
    border:1px solid rgba(148,163,184,0.9);
    color:var(--text-soft);
    box-shadow:none;
  }
  .btn.ghost:hover{
    background:#e5e7eb;
  }
  .btn.small{padding:7px 10px;font-size:12.5px;border-radius:8px}
  .btn.danger{
    background:#ef4444;color:white;
    box-shadow:0 6px 18px rgba(239,68,68,.18)
  }

  /* =========================
     SUGGESTIONS
  ========================= */
  .scrollable{max-height:620px;overflow:auto;padding-right:6px}

  /* =========================
     PROMPTS
  ========================= */
  .prompts-list{display:flex;flex-direction:column;gap:12px;margin-top:12px}
  .prompt-item{
    display:flex;gap:12px;align-items:stretch;
    background:#f3f4f6;
    padding:12px;border-radius:10px;
    border:1px solid var(--border);
  }
  .prompt-number{
    background:var(--accent);
    color:#ffffff;
    width:32px;height:32px;border-radius:8px;
    display:flex;align-items:center;justify-content:center;
    font-weight:900;
  }

  /* =========================
     MODAL
  ========================= */
  .modal-backdrop{
    position:fixed;inset:0;background:rgba(15,23,42,0.40);
    display:flex;align-items:center;justify-content:center;z-index:1000
  }
  .modal{
    width:90%;max-width:900px;max-height:85vh;
    background:var(--card);padding:20px;border-radius:12px;
    box-shadow:var(--shadow-lg);
    border:1px solid rgba(15,23,42,0.14);
    overflow:auto;
  }

  /* =========================
     SKELETONS + LOADING
  ========================= */
  .skeleton{
    position:relative;overflow:hidden;
    background:#d4d4d8;border-radius:10px
  }
  .skeleton::after{
    content:"";position:absolute;inset:0;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,.75), transparent);
    transform:translateX(-100%);animation:shimmer 1.4s infinite;
  }
  @keyframes shimmer{to{transform:translateX(100%)}}
  .estimating.pill::before{
    content:"";display:inline-block;width:10px;height:10px;border-radius:50%;
    margin-right:8px;border:2px solid rgba(148,163,184,0.7);
    border-top-color: var(--accent);
    animation: spin .9s linear infinite;vertical-align:middle;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* =========================
     TOAST
  ========================= */
  .toast-root{
    position:fixed;bottom:18px;right:18px;
    display:flex;flex-direction:column;gap:10px;z-index:1100
  }
  .toast{
    background:linear-gradient(180deg, rgba(249,250,251,.98), rgba(249,250,251,1));
    border:1px solid rgba(148,163,184,.9);
    color:var(--text);
    padding:12px 14px;border-radius:10px;
    box-shadow:var(--shadow-md);
    min-width:220px;max-width:360px
  }

  /* =========================
     SMALL HELPERS
  ========================= */
  .toolbar{
    display:flex;gap:12px;justify-content:space-between;
    align-items:center;margin-bottom:12px
  }
  .toolbar-right{display:flex;gap:10px}
  </style>

</head>
<body>
  <div class="wrap">
    <noscript>JavaScript is required.</noscript>

    <!-- Header with Profile -->
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <img src="assets/tech9labs_logo.png" alt="Tech9Labs Logo">
        </div>
        <div>
          <h1>Nutanix Services â€” Proposal Builder</h1>
          <div class="subtitle">AI-powered proposal generation</div>
        </div>
      </div>

      <!-- Profile / Auth UI -->
      <div id="userSection" class="user-section" style="display:flex;align-items:center;gap:12px;">
        <div id="userInfo" style="color:var(--muted);font-size:13px;display:none;text-align:right;">
          <span id="userName"></span><br/>
          <span id="userEmail" style="font-size:12px;color:var(--muted-2)"></span>
        </div>
        <button id="loginBtn" class="btn small">Login</button>
        <button id="logoutBtn" class="btn small ghost" style="display:none;">Logout</button>
      </div>
    </header>

    <!-- Optional toolbar -->
    <div class="toolbar">
      <div></div>
      <div class="toolbar-right"></div>
    </div>

    <!-- SINGLE STEP: Client information & requirements -->
    <section id="step1" class="card" aria-labelledby="cfg-title">
      <div class="card-header">
        <h2 id="cfg-title" class="card-title">ðŸ“‹ Client Information & Requirements</h2>
      </div>

      <div class="form-grid">
        <div>
          <label for="client_name">Client Name *</label>
          <input id="client_name" type="text" placeholder="Enter client name" />
        </div>
        <div>
          <label for="industry_select">Industry *</label>
          <select id="industry_select">
            <option value="">Select industry...</option>
            <option>Technology</option>
            <option>Finance</option>
            <option>Retail</option>
            <option>Healthcare</option>
            <option>Manufacturing</option>
            <option>Facility Management & Cash Logistics</option>
            <option>Government</option>
            <option value="other">Otherâ€¦</option>
          </select>
        </div>
        <div id="industry_custom_wrap" style="display:none">
          <label for="industry_custom">Custom Industry</label>
          <input id="industry_custom" type="text" placeholder="Enter custom industry name...">
        </div>
        <div>
          <label for="deployment_type">Deployment Type</label>
          <select id="deployment_type">
            <option value="">Select deployment...</option>
            <option value="onsite">On-Site</option>
            <option value="remote">Remote</option>
            <option value="hybrid">Hybrid</option>
            <option value="dark_site">Air-Gapped / Dark Site</option>
          </select>
        </div>
        <div>
          <label for="proposal_type">Proposal Type</label>
          <select id="proposal_type">
            <option value="detailed" selected>Detailed Proposal (20-40 Pages)</option>
            <option value="short">Short Proposal (5-10 Pages)</option>
          </select>
        </div>
      </div>

      <div style="margin-top:12px">
        <label for="requirements_text">Service Requirements</label>
        <textarea id="requirements_text" placeholder="Enter client requirements (one per line)"></textarea>
      </div>

      <!-- Vendor filter + BOQ -->
      <div class="form-grid" style="margin-top:12px">
        <div>
          <label>Hardware Provider</label>
          <!-- changed background to light -->
          <div id="hardware_providers_group" style="display:grid;grid-template-columns:repeat(2, minmax(0,1fr));gap:8px;padding:10px;border:1px solid var(--border);border-radius:var(--radius-xs);background:#f9fafb">
            <label style="display:flex;gap:8px;align-items:center">
              <input type="checkbox" name="hwprov" value="Nutanix"/> <span>Nutanix</span>
            </label>
            <label style="display:flex;gap:8px;align-items:center">
              <input type="checkbox" name="hwprov" value="Dell"/> <span>Dell</span>
            </label>
            <label style="display:flex;gap:8px;align-items:center">
              <input type="checkbox" name="hwprov" value="HP"/> <span>HP / HPE</span>
            </label>
            <label style="display:flex;gap:8px;align-items:center">
              <input type="checkbox" name="hwprov" value="Lenovo"/> <span>Lenovo</span>
            </label>
            <label style="display:flex;gap:8px;align-items:center">
              <input type="checkbox" name="hwprov" value="Cisco"/> <span>Cisco</span>
            </label>
            <div style="grid-column:1/-1;display:flex;gap:10px;margin-top:4px">
              <button id="hwprov_clear" class="btn small ghost" type="button">Clear</button>
            </div>
          </div>
        </div>

        <div style="grid-column: span 3;">
          <label for="boq_text">Nutanix Software (BoQ)</label>
          <textarea id="boq_text" placeholder="Paste BOQ or current stack: e.g., 6 nodes AHV, DR required, NC2 on AWS, Files, Oracle DBâ€¦"></textarea>
        </div>
      </div>

      <!-- Optional prompts area -->
      <div id="promptsArea" class="prompts-list" aria-live="polite"></div>

      <div style="margin-top:12px">
        <label for="files">Supporting Documents - Solution/SoW (Optional)</label>
        <input id="files" type="file" multiple accept=".pdf,.docx,.txt,.xlsx,.xls" />
        <div class="help-text">ðŸ“Ž Upload up to 3 files (PDF, DOCX, TXT, XLSX, XLS)</div>
      </div>

      <div class="row" style="margin-top:14px">
        <div class="help-text" id="analyzeStatus" style="flex:1">
          Ensure that all inputs along with necessary supporting documents are well placed for a refined proposal document
        </div>
        <button id="generateBtn" class="btn">Generate Proposal</button>
      </div>

      <div id="suggestions" class="scrollable" style="margin-top:14px" aria-live="polite"></div>
    </section>
  </div>

  <!-- Modal root -->
  <div id="previewModal" style="display:none"></div>

  <!-- Toast root -->
  <div id="toastRoot" class="toast-root" aria-live="polite" aria-atomic="true"></div>

  <!-- App script -->
  <script src="script.js"></script>

  <!-- Tiny toast helper + minimal auth header glue -->
  <script>
    (function(){
      // Toasts
      const root = document.getElementById('toastRoot');
      window.toast = function(msg){
        if(!root) return alert(msg);
        const el = document.createElement('div');
        el.className = 'toast';
        el.textContent = msg;
        root.appendChild(el);
        setTimeout(()=>{ el.style.opacity='.96'; }, 10);
        setTimeout(()=>{ el.style.opacity='0'; el.style.transform='translateY(6px)'; }, 2400);
        setTimeout(()=>{ el.remove(); }, 2800);
      };

      // Industry "Otherâ€¦" toggle
      const sel = document.getElementById('industry_select');
      const wrap = document.getElementById('industry_custom_wrap');
      sel && sel.addEventListener('change', () => {
        wrap.style.display = (sel.value === 'other') ? '' : 'none';
      });

      // Minimal profile header glue (fetch /auth/me if token exists)
      const API_BASE = "";
      const userInfo = document.getElementById("userInfo");
      const userName = document.getElementById("userName");
      const userEmail = document.getElementById("userEmail");
      const loginBtn = document.getElementById("loginBtn");
      const logoutBtn = document.getElementById("logoutBtn");

      async function loadProfile(){
        const token = localStorage.getItem("access_token");
        if(!token){
          loginBtn.style.display='inline-flex';
          logoutBtn.style.display='none';
          userInfo.style.display='none';
          return;
        }
        try{
          const res = await fetch(`${API_BASE}/auth/me`, {
            headers:{ Authorization:`Bearer ${token}` }
          });
          if(!res.ok) throw new Error('invalid');
          const p = await res.json();
          userInfo.style.display = 'block';
          userName.textContent = p.full_name || 'User';
          userEmail.textContent = p.email || '';
          loginBtn.style.display = 'none';
          logoutBtn.style.display = 'inline-flex';
        }catch{
          localStorage.removeItem("access_token");
          loginBtn.style.display='inline-flex';
          logoutBtn.style.display='none';
          userInfo.style.display='none';
        }
      }

      loginBtn.addEventListener('click', ()=>{ window.location.href = 'login.html'; });
      logoutBtn.addEventListener('click', ()=>{
        localStorage.removeItem('access_token');
        toast('You have been logged out.');
        userInfo.style.display='none';
        loginBtn.style.display='inline-flex';
        logoutBtn.style.display='none';
      });

      loadProfile();
    })();
  </script>
</body>
</html>
